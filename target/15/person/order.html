<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=0">

		<title>订单管理</title>

		<link href="./AmazeUI-2.4.2/assets/css/admin.css" rel="stylesheet" type="text/css">
		<link href="https://cdn.bootcss.com/amazeui/2.5.1/css/amazeui.css" rel="stylesheet" type="text/css" />

		<link href="./css/personal.css" rel="stylesheet" type="text/css">
		<link href="./css/orstyle.css" rel="stylesheet" type="text/css">

		<script src="https://www.jq22.com/jquery/jquery-1.10.2.js"></script>
		<script src="https://cdn.bootcss.com/amazeui/2.5.1/js/amazeui.min.js"></script>
		<script src="./js/include.js"></script>
		<script src="./js/handlebars-v4.7.6.js"></script>
	</head>

	<body>
		
		<div id="header"></div>
	
		<b class="line"></b>
		<div class="center">
			<div class="col-main">
				<div class="main-wrap">

					<div class="user-order">

						<!--标题 -->
						<div class="am-cf am-padding">
							<div class="am-fl am-cf"><strong class="am-text-danger am-text-lg">订单管理</strong> / <small>Order</small></div>
						</div>
						<hr/>

						<div class="am-tabs am-tabs-d2 am-margin" data-am-tabs>

							<ul class="am-avg-sm-5 am-tabs-nav am-nav am-nav-tabs">
								<li class="am-active"><a href="#tab1">所有订单</a></li>

							</ul>
<!-- 全部订单开始 -->
							<div class="am-tabs-bd">
								<div class="am-tab-panel am-fade am-in am-active" id="tab1">
									<!-- 头部 -->
									<div class="order-top">
										<div class="th th-item">
											<td class="td-inner">商品</td>
										</div>
										<div class="th th-price">
											<td class="td-inner">单价</td>
										</div>
										<div class="th th-number">
											<td class="td-inner">数量</td>
										</div>
										<div class="th th-operation">
											<td class="td-inner">商品操作</td>
										</div>
										<div class="th th-amount">
											<td class="td-inner">合计</td>
										</div>
										<div class="th th-status">
											<td class="td-inner">交易状态</td>
										</div>
										<div class="th th-change">
											<td class="td-inner">交易操作</td>
										</div>
									</div>
									<!-- 订单主体内容-->
									<div class="order-main">
										<div class="order-list order-list11">
											
											<!--交易成功-->
											<!--  第一个订单-->

											<div class="order-status5">

											</div>

										</div>

									</div>

								</div>
<!-- 全部订单结束 -->




								

							</div>

						</div>
					</div>
				</div>
				<!--底部-->
				<div class="footer">
					<div class="footer-hd">
						<p>

							<b>|</b>
							<a href="#">商城首页</a>
							<b>|</b>
							<a href="#">支付宝</a>
							<b>|</b>
							<a href="#">物流</a>
						</p>
					</div>
					<div class="footer-bd">
						<p>

							<a href="#">合作伙伴</a>
							<a href="#">联系我们</a>
							<a href="#">网站地图</a>
							<em>© 2016-2026 XXXX 版权所有 <a href="http://www.cssmoban.com/" target="_blank" title="版权所有">版权所有</a> - Collect from</em>
						</p>
					</div>

				</div>
			</div>
			<aside class="menu">
				<ul>
					<li class="person">
						<a href="index.html">个人中心</a>
					</li>
					<li class="person">
						<a href="#">个人资料</a>
						<ul>
							<li> <a href="information.html">个人信息</a></li>
							<li> <a href="safety.html">安全设置</a></li>
							<li> <a href="address.html">收货地址</a></li>
						</ul>
					</li>
					<li class="person">
						<a href="#">我的交易</a>
						<ul>
							<li class="active"><a href="order.html">订单管理</a></li>
							<li> <a href="change.html">退款售后</a></li>
						</ul>
					</li>
					<li class="person">
						<a href="#">我的资产</a>
						<ul>
							<li> <a href="coupon.html">优惠券 </a></li>
							<li> <a href="bonus.html">红包</a></li>
							<li> <a href="bill.html">账单明细</a></li>
						</ul>
					</li>

					<li class="person">
						<a href="#">我的小窝</a>
						<ul>
							<li> <a href="collection.html">收藏</a></li>
							<li> <a href="foot.html">足迹</a></li>
							<li> <a href="comment.html">评价</a></li>
							<li> <a href="news.html">消息</a></li>
						</ul>
					</li>

				</ul>

			</aside>
		</div>

	</body>
	<!-- 默认地址模板 -->
	<script type="text/template" id="tbody-tr">
		{{#each this}}
		<div class="order-status5">

			<div class="order-title">
				<div class="dd-num">订单编号：<a href="javascript:;">{{orderId}}</a></div>
				<span>成交时间：{{addTime}}</span>
				<!--    <em>店铺：小桔灯</em>-->
			</div>
			<div class="order-content {{orderId}}">
				<div class="order-left {{orderInfo}}"></div>
			</div>
		</div>
		{{/each}}
	</script>
	<script type="text/template" id="tbody-tr1">
		{{#each this}}

			<ul class="item-list">
				<li class="td td-item">
					<div class="item-pic">
						<a href="#" class="J_MakePoint">
							<img src="../oUser{{foodPic}}" class="itempic J_ItemImg">
						</a>
					</div>
					<div class="item-info">
						<div class="item-basic-info">
							<a href="#">
								<p>{{foodName}}</p>
								<p class="info-little">颜色：默认
									<br/>包装：默认 </p>
							</a>
						</div>
					</div>
				</li>
				<li class="td td-price">
					<div class="item-price">
						{{foodPrice}}
					</div>
				</li>
				<li class="td td-number">
					<div class="item-number">
						<span>×</span>{{foodNum}}
					</div>
				</li>
				<li class="td td-operation">
					<div class="item-operation">

					</div>
				</li>
			</ul>


		{{/each}}
	</script>
	<script>
		function upStatus(oid){
			$.post("../OrderServlet/upStatus",{orderId:oid},function (d) {
				if (d){
					alert("收货成功");
					location.reload();
				}else {
					alert("收货失败，请重试。")
				}
			})

		}
		$(function () {

			var tpl = $('#tbody-tr').html();
			var tpl1 = $('#tbody-tr1').html();
			var template = Handlebars.compile(tpl);
			var template1 = Handlebars.compile(tpl1);
			var s = window.localStorage;
			var a1 = JSON.parse(s.UserInfo);
			var userId = a1.userId;
			console.log(userId)
			$.post("../OrderServlet/FindUserOrder",{userId:userId},function (d) {

				$(".order-list11").html(template(d));
				for (var i=0;i<d.length;i++){
					console.log()
					$.post("../OrderServlet/FindUserOrderInfo",{orderInfo:d[i].orderInfo},function (data) {

						$("."+data[0].orderInfo+"").html(template1(data));
					})
					$("."+d[i].orderId+"").append('<div class="order-right">\n' +
							'\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li class="td td-amount">\n' +
							'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-amount">\n' +
							'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t合计：' +
							d[i].cause +
							'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p>含运费：<span>0.00</span></p>\n' +
							'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n' +
							'\t\t\t\t\t\t\t\t\t\t\t\t\t\t</li>\n' +
							'\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="move-right">\n' +
							'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li class="td td-status">\n' +
							'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-status">\n' +
							'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p class="Mystatus">'+d[i].sendStatus+'</p>\n' +
							'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p class="order-info"><a href="orderinfo.html?orderId='+
							d[i].orderId	+'&addTime='+
							d[i].addTime+ '&orderInfo='+d[i].orderInfo
							+ '">订单详情</a></p>\n' +
							'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p class="order-info"><a href="logistics.html">查看物流</a></p>\n' +
							'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n' +
							'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</li>\n' +
							'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li class="td td-change">\n' +
							'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a  id="ooooid" href="commentlist.html?orderInfo='+d[i].orderInfo+'" >\n' +
							'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="am-btn am-btn-danger anniu" onclick="upStatus('+d[i].orderId+')"  data-orderid="'+d[i].orderId+'">\n' +
							'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t评价商品</div>\n' +
							'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>\n' +
							'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</li>\n' +
							'\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n' +
							'\t\t\t\t\t\t\t\t\t\t\t\t\t</div>')

				}
				var oid;
				$('.Mystatus').each(function () {
					// console.log($(this).html());
					// console.log($(this).parents('.item-status').parents('.td-status').html());
					// console.log($(this).parents('.td-status').siblings('.td-change').html());
					// console.log($(this).parents('.move-right').find('.anniu').html());
					if($(this).html()=='已配送'){
						// console.log($(this).parent('.td-status').find('.anniu').val());
						$(this).parents('.move-right').find('.anniu').addClass('am-btn-success').html('确认收货');
						$(this).parents('.move-right').find('a').attr('href','javascript:;');

						oid=$(this).parents('.move-right').find('.anniu').data("orderid");
						console.log(oid)
						$(this).parents('.move-right').find('#ooooid').on("click",);


					}
					if($(this).html()=='未配送'){
						// console.log($(this).parent('.td-status').find('.anniu').val());
						$(this).parents('.move-right').find('.anniu').addClass('am-btn-secondary').html('提醒收货');
						$(this).parents('.move-right').find('a').attr('href','javascript:;');

						$(this).parents('.move-right').find('.anniu').attr('onclick', '').unbind('click');



					}
					if($(this).html()=='已评论'){
						// console.log($(this).parent('.td-status').find('.anniu').val());
						$(this).parents('.move-right').find('.anniu').addClass('am-btn-secondary').html('订单已完成');
						$(this).parents('.move-right').find('a').attr('href','javascript:;');

						$(this).parents('.move-right').find('.anniu').attr('onclick', '').unbind('click');



					}
				})

			})
		})

	</script>
</html>