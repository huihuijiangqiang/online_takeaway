<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=0">

	<title>地址管理</title>
	<script src="./js/jquery.min.js"></script>
	<link href="./AmazeUI-2.4.2/assets/css/admin.css" rel="stylesheet" type="text/css">
	<link href="https://cdn.bootcss.com/amazeui/2.5.1/css/amazeui.css" rel="stylesheet" type="text/css" />

	<link href="./css/personal.css" rel="stylesheet" type="text/css">
	<link href="./css/addstyle.css" rel="stylesheet" type="text/css">
	<script src="https://cdn.bootcss.com/amazeui/2.5.1/js/amazeui.min.js"></script>
	<script src="./js/include.js"></script>



	<script src="./js/handlebars-v4.7.6.js"></script>
	<script src="./js/xcity.js"></script>



	<style>
		.aaaaaa {
			/* background-color: pink; */
			overflow: hidden;
			/* float:right; */
			height: 40px;
			width: 400px !important;
			padding-left: 10px;
		}

		.aaaaaa select {
			width: 100px;
			left: 10px;
			display: inline-table
		}
	</style>

</head>

<body>
	<!--头 -->
	<div id="header"></div>
	<b class="line"></b>


	<div class="center">
		<div class="col-main">
			<div class="main-wrap">

				<div class="user-address">
					<!--标题 -->
					<div class="am-cf am-padding">
						<div class="am-fl am-cf"><strong class="am-text-danger am-text-lg">地址管理</strong> /
							<small>Address&nbsp;list</small></div>
					</div>
					<hr />
					<ul class="am-avg-sm-1 am-avg-md-3 am-thumbnails UserAddr">

						<li class="user-addresslist defaultAddr">
							<span class="new-option-r"><i class="am-icon-check-circle"></i>默认地址</span>
							<p class="new-tit new-p-re">
								<span class="new-txt">小叮当</span>
								<span class="new-txt-rd2">159****1622</span>
							</p>
							<div class="new-mu_l2a new-p-re">
								<p class="new-mu_l2cw">
									<span class="title">地址：</span>
									<span class="province">湖北</span>省
									<span class="city">武汉</span>市
									<span class="dist">洪山</span>区
									<span class="street">雄楚大道666号(中南财经政法大学)</span></p>
							</div>
							<div class="new-addr-btn">
								<a href="#"><i class="am-icon-edit"></i>编辑</a>
								<span class="new-addr-bar">|</span>
								<a href="javascript:void(0);" onclick="delClick(this);"><i
										class="am-icon-trash"></i>删除</a>
							</div>
						</li>

						<li class="user-addresslist">
							<span class="new-option-r"><i class="am-icon-check-circle"></i>设为默认</span>
							<p class="new-tit new-p-re">
								<span class="new-txt">小叮当</span>
								<span class="new-txt-rd2">159****1622</span>
							</p>
							<div class="new-mu_l2a new-p-re">
								<p class="new-mu_l2cw">
									<span class="title">地址：</span>
									<span class="province">湖北</span>省
									<span class="city">武汉</span>市
									<span class="dist">洪山</span>区
									<span class="street">雄楚大道666号(中南财经政法大学)</span></p>
							</div>
							<div class="new-addr-btn">
								<a href="#"><i class="am-icon-edit"></i>编辑</a>
								<span class="new-addr-bar">|</span>
								<a href="javascript:void(0);" onclick="delClick(this);"><i
										class="am-icon-trash"></i>删除</a>
							</div>
						</li>
						<li class="user-addresslist">
							<span class="new-option-r"><i class="am-icon-check-circle"></i>设为默认</span>
							<p class="new-tit new-p-re">
								<span class="new-txt">小叮当</span>
								<span class="new-txt-rd2">159****1622</span>
							</p>
							<div class="new-mu_l2a new-p-re">
								<p class="new-mu_l2cw">
									<span class="title">地址：</span>
									<span class="province">湖北</span>省
									<span class="city">武汉</span>市
									<span class="dist">洪山</span>区
									<span class="street">雄楚大道666号(中南财经政法大学)</span></p>
							</div>
							<div class="new-addr-btn">
								<a href="#"><i class="am-icon-edit"></i>编辑</a>
								<span class="new-addr-bar">|</span>
								<a href="javascript:void(0);" onclick="delClick(this);"><i
										class="am-icon-trash"></i>删除</a>
							</div>
						</li>
					</ul>
					<div class="clear"></div>
					<a class="new-abtn-type" data-am-modal="{target: '#doc-modal-1', closeViaDimmer: 0}">添加新地址</a>
					<!--例子-->
					<div class="am-modal am-modal-no-btn" id="doc-modal-1">

						<div class="add-dress">

							<!--标题 -->
							<div class="am-cf am-padding">
								<div class="am-fl am-cf"><strong class="am-text-danger am-text-lg ead">新增地址</strong> /
									<small>Add&nbsp;address</small></div>
							</div>
							<hr />

							<div class="am-u-md-12 am-u-lg-8" style="margin-top: 20px;">
								<form class="am-form am-form-horizontal">

									<div class="am-form-group">
										<label for="user-name" class="am-form-label">收货人</label>
										<div class="am-form-content">
											<input type="text" id="user-name" placeholder="收货人">
										</div>
									</div>

									<div class="am-form-group">
										<label for="user-phone" class="am-form-label">手机号码</label>
										<div class="am-form-content">
											<input id="user-phone" placeholder="手机号必填" type="email">
										</div>
									</div>
									<div class="am-form-group ">
										<label for="user-address" class="am-form-label">所在地</label>
										<div class="aaaaaa" style="width: 100px;">
											<script>
												$(function () {
													$.get("add.html", function (data) {
														$(".aaaaaa").html(data);
													});

												});
											</script>
										</div>
									</div>


									<div class="am-form-group">
										<label for="user-intro" class="am-form-label">详细地址</label>
										<div class="am-form-content">
											<textarea class="" rows="3" id="user-intro" placeholder="输入详细地址"></textarea>
											<small>100字以内写出你的详细地址...</small>
										</div>
									</div>

									<div class="am-form-group">
										<div class="am-u-sm-9 am-u-sm-push-3">
											<a class="am-btn am-btn-danger" id="mySave" onclick="savaUserAddr()">保存</a>
											<a href="javascript: void(0)" class="am-close am-btn am-btn-danger"
												data-am-modal-close>取消</a>
										</div>
									</div>
								</form>
							</div>

						</div>

					</div>

				</div>

				<script type="text/javascript">
					$(document).ready(function () {
						$(".new-option-r").click(function () {
							$(this).parent('.user-addresslist').addClass("defaultAddr").siblings().removeClass("defaultAddr");
						});

						var $ww = $(window).width();
						if ($ww > 640) {
							$("#doc-modal-1").removeClass("am-modal am-modal-no-btn")
						}

					})
				</script>

				<div class="clear"></div>

			</div>
			<!--底部-->
			<div class="footer">
				<div class="footer-hd">
					<p>
						<a href="#">XX科技</a>
						<b>|</b>
						<a href="#">商城首页</a>
						<b>|</b>
						<a href="#">支付宝</a>
						<b>|</b>
						<a href="#">物流</a>
					</p>
				</div>
				<div class="footer-bd">
					<p>
						<a href="#">关于XX</a>
						<a href="#">合作伙伴</a>
						<a href="#">联系我们</a>
						<a href="#">网站地图</a>
						<em>© 2016-2026 XXXX 版权所有 <a href="http://www.cssmoban.com/" target="_blank"
								title="版权所有">版权所有</a> - Collect from</em>
					</p>
				</div>
			</div>
		</div>

		<aside class="menu">
			<ul>
				<li class="person">
					<a href="index.html">个人中心</a>
				</li>
				<li class="person">
					<a href="#">个人资料</a>
					<ul>
						<li> <a href="information.html">个人信息</a></li>
						<li> <a href="safety.html">安全设置</a></li>
						<li class="active"> <a href="address.html">收货地址</a></li>
					</ul>
				</li>
				<li class="person">
					<a href="#">我的交易</a>
					<ul>
						<li><a href="order.html">订单管理</a></li>
						<li> <a href="change.html">退款售后</a></li>
					</ul>
				</li>
				<li class="person">
					<a href="#">我的资产</a>
					<ul>
						<li> <a href="coupon.html">优惠券 </a></li>
						<li> <a href="bonus.html">红包</a></li>
						<li> <a href="bill.html">账单明细</a></li>
					</ul>
				</li>

				<li class="person">
					<a href="#">我的小窝</a>
					<ul>
						<li> <a href="collection.html">收藏</a></li>
						<li> <a href="foot.html">足迹</a></li>
						<li> <a href="comment.html">评价</a></li>
						<li> <a href="news.html">消息</a></li>
					</ul>
				</li>

			</ul>

		</aside>
	</div>
	<script src="./js/layui.js"></script>
	<!-- 默认地址模板 -->
	<script type="text/template" id="tbody-tr">
		{{#each this}}
		<li class="user-addresslist addli{{userAddrId}}">
			<span class="new-option-r"><i class="am-icon-check-circle"></i>设为默认</span>
			<p class="new-tit new-p-re">
				<span class="new-txt">{{userName}}</span>
				<span class="new-txt-rd2">{{userTel}}</span>
			</p>
			<div class="new-mu_l2a new-p-re">
				<p class="new-mu_l2cw">
					<span class="title">地址：</span>
					<span class="province">{{u_province}}</span>
					<span class="city">{{u_city}}</span>
					<span class="dist">{{u_county}}</span>
					<span class="street">{{u_info}}</span></p>
			</div>
			<div class="new-addr-btn">
				<a href="javascript:;" onclick="editAddr({{userAddrId}})"><i class="am-icon-edit"></i>编辑</a>
				<span class="new-addr-bar">|</span>
				<a href="javascript:void(0);" onclick="delClick({{userAddrId}});"><i class="am-icon-trash"></i>删除</a>
			</div>
		</li>
		{{/each}}
	</script>

	<script src="./js/json3.js"></script>
	<script>
		var s = window.localStorage;
		var a1 = JSON.parse(s.UserInfo);


		var userId = a1.userId;
		console.log(userId);
		//添加数据
		var tpl = $('#tbody-tr').html();
		var template = Handlebars.compile(tpl);

		$.post("../UserServlet/FindUserAddr", { userId: userId }, function (data) {
			// var obj = JSON.parse(data);
			//将数据转为字符串
			var obj = JSON.stringify(data);
			//字符串存储到本地
			var s = window.localStorage;
			//移除已存储得
			s.removeItem("UserAddr");
			//添加新的
			s["UserAddr"] = obj;
			// console.log(data);

			$(".UserAddr").html(template(data));
		})


		/**
		 * 删除收货地址
		 * /@abstract
		 * */
		function delClick(a) {

			$(".addli" + a).remove()
			$.post("../UserServlet/delUserAddr", { "userAddrId": a }, function (params) {
				console.log(params);
				alert("删除成功")
			})
		}
		/**
		 * 新增加收货地址
		 * 
		 * */
		function savaUserAddr() {
			var userName = $("#user-name").val();
			var userTel = $("#user-phone").val();
			var u_province = document.getElementById('s_province').value;
			var u_city = document.getElementById('s_city').value;
			var u_county = document.getElementById('s_county').value;
			var u_info = $("#user-intro").val();
			console.log(userName + userTel + u_province + u_city + u_county + u_info + userId);
			$.post("../UserServlet/saveUserAddr", {
				userId: userId, userName: userName,userTel:userTel,
				u_province: u_province, u_city: u_city, u_county: u_county, u_info: u_info
			}, function () {
				alert("添加成功请刷新")
			})


		}

		/**
		 * 编辑收货地址
		 */
		function editAddr(id) {
			$('.ead').html("编辑地址");
			$('#user-name').val($('.addli'+id).find('.new-txt').html());
			$('#user-phone').val($('.addli'+id).find('.new-txt-rd2').html());
			$('#user-intro').val($('.addli'+id).find('.street').html());
			$('#s_province').val($('.addli'+id).find('.province').html());
			$('#s_city').val($('.addli'+id).find('.city').html());
			$('#s_county').val($('.addli'+id).find('.dist').html());
			$('#mySave').attr("onclick","editA("+id+")")


		}
		function editA(id) {
			var userName = $("#user-name").val();
			var userTel = $("#user-phone").val();
			var u_province = document.getElementById('s_province').value;
			var u_city = document.getElementById('s_city').value;
			var u_county = document.getElementById('s_county').value;
			var u_info = $("#user-intro").val();
			console.log(userName + userTel + u_province + u_city + u_county + u_info + userId);
			$.post("../UserServlet/editUserAddr", {
				userId: userId, userName: userName,userTel:userTel,
				u_province: u_province, u_city: u_city,
				u_county: u_county, u_info: u_info,
				userAddrId: id
			}, function () {
				alert("编辑成功请刷新")
			})
		}

	</script>

</body>


</html>